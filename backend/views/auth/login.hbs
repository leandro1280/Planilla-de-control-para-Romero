<div class="card shadow-lg border-0">
  <div class="card-body p-4 p-md-5">
    <h2 class="card-title text-center mb-4 fw-bold">Iniciar Sesión</h2>
    
    <form action="/auth/login" method="POST" id="loginForm">
      <div class="mb-3">
        <label for="email" class="form-label fw-semibold">Email</label>
        <input 
          type="email" 
          class="form-control form-control-lg" 
          id="email" 
          name="email" 
          required 
          autofocus
          placeholder="tu@email.com"
        >
      </div>
      
      <div class="mb-4">
        <label for="password" class="form-label fw-semibold">Contraseña</label>
        <div class="input-group">
          <input 
            type="password" 
            class="form-control form-control-lg" 
            id="password" 
            name="password" 
            required
            placeholder="••••••••"
          >
          <button class="btn btn-outline-secondary" type="button" id="togglePassword">
            <i class="bi bi-eye" id="togglePasswordIcon"></i>
          </button>
        </div>
      </div>
      
      <button type="submit" class="btn btn-primary btn-lg w-100 fw-semibold mb-3">
        Ingresar
      </button>
      
      <div class="text-center">
        <p class="text-muted small mb-0">
          ¿Problemas para ingresar? Contacta al administrador
        </p>
      </div>
    </form>
  </div>
</div>

<script>
// Toggle para mostrar/ocultar contraseña
document.getElementById('togglePassword')?.addEventListener('click', function() {
  const passwordInput = document.getElementById('password');
  const icon = document.getElementById('togglePasswordIcon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    icon.classList.remove('bi-eye');
    icon.classList.add('bi-eye-slash');
  } else {
    passwordInput.type = 'password';
    icon.classList.remove('bi-eye-slash');
    icon.classList.add('bi-eye');
  }
});

// Login
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const emailOriginal = formData.get('email');
  const email = emailOriginal?.toLowerCase().trim() || '';
  const password = formData.get('password') || '';
  
  const payload = { email, password };
  
  try {
    const response = await fetch('/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      credentials: 'include',
      body: JSON.stringify(payload)
    });
    
    const result = await response.json();
    
    if (result.success) {
      window.location.href = '/dashboard';
    } else {
      let errorMsg = result.message || 'Error al iniciar sesión';
      if (result.errors && result.errors.length > 0) {
        errorMsg = result.errors.map(e => e.msg).join(', ');
      }
      alert('❌ Error: ' + errorMsg);
    }
  } catch (error) {
    alert('❌ Error de conexión. Por favor intenta nuevamente.');
  }
});
</script>

