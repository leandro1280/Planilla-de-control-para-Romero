<div class="card shadow-lg border-0">
  <div class="card-body p-4 p-md-5">
    <h2 class="card-title text-center mb-4 fw-bold">Iniciar SesiÃ³n</h2>
    
    <form action="/auth/login" method="POST" id="loginForm">
      <div class="mb-3">
        <label for="email" class="form-label fw-semibold">Email</label>
        <input 
          type="email" 
          class="form-control form-control-lg" 
          id="email" 
          name="email" 
          required 
          autofocus
          placeholder="tu@email.com"
        >
      </div>
      
      <div class="mb-4">
        <label for="password" class="form-label fw-semibold">ContraseÃ±a</label>
        <div class="input-group">
          <input 
            type="password" 
            class="form-control form-control-lg" 
            id="password" 
            name="password" 
            required
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          >
          <button class="btn btn-outline-secondary" type="button" id="togglePassword">
            <i class="bi bi-eye" id="togglePasswordIcon"></i>
          </button>
        </div>
        <small class="form-text text-muted d-block mt-2">
          ğŸ” DEBUG: Ver contraseÃ±a activado para desarrollo
        </small>
      </div>
      
      <button type="submit" class="btn btn-primary btn-lg w-100 fw-semibold mb-3">
        Ingresar
      </button>
      
      <div class="text-center">
        <p class="text-muted small mb-0">
          Â¿Problemas para ingresar? Contacta al administrador
        </p>
      </div>
    </form>
  </div>
</div>

<script>
// Toggle para mostrar/ocultar contraseÃ±a
document.getElementById('togglePassword')?.addEventListener('click', function() {
  const passwordInput = document.getElementById('password');
  const icon = document.getElementById('togglePasswordIcon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    icon.classList.remove('bi-eye');
    icon.classList.add('bi-eye-slash');
  } else {
    passwordInput.type = 'password';
    icon.classList.remove('bi-eye-slash');
    icon.classList.add('bi-eye');
  }
});

// Login
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ” INICIO DE PROCESO DE LOGIN');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  const formData = new FormData(this);
  const emailOriginal = formData.get('email');
  const email = emailOriginal?.toLowerCase().trim() || '';
  const password = formData.get('password') || '';
  
  console.log('ğŸ“‹ DATOS DEL FORMULARIO:');
  console.log('   ğŸ“§ Email original:', emailOriginal);
  console.log('   ğŸ“§ Email normalizado:', email);
  console.log('   ğŸ”‘ ContraseÃ±a:', password);
  console.log('   ğŸ“ Longitud contraseÃ±a:', password.length);
  console.log('   ğŸ” Tipo de email:', typeof email);
  console.log('   ğŸ” Tipo de password:', typeof password);
  
  const payload = { email, password };
  console.log('ğŸ“¦ PAYLOAD A ENVIAR:', JSON.stringify(payload));
  
  try {
    console.log('\nğŸŒ ENVIANDO PETICIÃ“N AL SERVIDOR...');
    console.log('   URL: /auth/login');
    console.log('   MÃ©todo: POST');
    
    const response = await fetch('/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      credentials: 'include',
      body: JSON.stringify(payload)
    });
    
    console.log('\nğŸ“¥ RESPUESTA DEL SERVIDOR:');
    console.log('   Status:', response.status);
    console.log('   Status Text:', response.statusText);
    console.log('   Headers:', Object.fromEntries(response.headers.entries()));
    
    const result = await response.json();
    console.log('   Body:', JSON.stringify(result, null, 2));
    
    if (result.success) {
      console.log('\nâœ… LOGIN EXITOSO');
      console.log('   Redirigiendo a /dashboard');
      window.location.href = '/dashboard';
    } else {
      console.log('\nâŒ LOGIN FALLIDO');
      let errorMsg = result.message || 'Error al iniciar sesiÃ³n';
      if (result.errors && result.errors.length > 0) {
        errorMsg = result.errors.map(e => e.msg).join(', ');
        console.log('   Errores de validaciÃ³n:', result.errors);
      }
      console.log('   Mensaje de error:', errorMsg);
      alert('âŒ Error: ' + errorMsg);
    }
  } catch (error) {
    console.log('\nğŸ’¥ ERROR DE CONEXIÃ“N:');
    console.error('   Error completo:', error);
    console.error('   Mensaje:', error.message);
    console.error('   Stack:', error.stack);
    alert('âŒ Error de conexiÃ³n. Por favor intenta nuevamente.');
  }
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ” FIN DE PROCESO DE LOGIN');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
});
</script>

