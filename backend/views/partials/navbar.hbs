{{#if usuario}}
<nav class="navbar navbar-expand-lg mb-4 rounded-3 shadow-lg custom-navbar">
  <div class="container-fluid px-3 px-md-4">
    <a class="navbar-brand d-flex align-items-center text-white fw-bold" href="/inventario" title="Ir al inicio">
      <img src="/img/logo-romero.png" alt="Romero Panificados" class="me-2 logo-navbar"
        style="height: 45px; max-width: 180px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse mt-3 mt-lg-0" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'inventario')}}active{{/if}}" href="/inventario" title="Inventario">
            <i class="bi bi-box-seam me-1"></i><span class="d-none d-md-inline">Inventario</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'movimientos')}}active{{/if}}" href="/movimientos" title="Movimientos">
            <i class="bi bi-list-check me-1"></i><span class="d-none d-md-inline">Movimientos</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'mantenimientos')}}active{{/if}}" href="/mantenimientos" title="Mantenimientos">
            <i class="bi bi-tools me-1"></i><span class="d-none d-md-inline">Mantenimientos</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'dashboard')}}active{{/if}}" href="/dashboard" title="Dashboard">
            <i class="bi bi-speedometer2 me-1"></i><span class="d-none d-xl-inline">Dashboard</span>
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="configMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-gear-fill me-1"></i><span class="d-none d-xl-inline">Más</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            {{#if (eq usuario.rol 'administrador')}}
            <li>
              <a class="dropdown-item {{#if (eq currentPage 'usuarios')}}active{{/if}}" href="/auth/register">
                <i class="bi bi-person-plus me-2"></i>Gestionar Usuarios
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            {{/if}}
            <li>
              <a class="dropdown-item {{#if (eq currentPage 'perfiles')}}active{{/if}}" href="/perfiles">
                <i class="bi bi-people me-2"></i>Perfiles y Roles
              </a>
            </li>
          </ul>
        </li>
      </ul>

      <ul class="navbar-nav align-items-lg-center ms-auto">
        <!-- Botón QR Universal para escanear códigos de fabricantes -->
        <li class="nav-item me-lg-2 mb-2 mb-lg-0">
          <button class="btn btn-link text-white p-2" type="button" id="btn-qr-universal" title="Escanear código QR">
            <i class="bi bi-qr-code-scan fs-5 d-none d-lg-inline"></i>
            <span class="d-lg-none"><i class="bi bi-qr-code-scan me-2"></i>Escanear QR</span>
          </button>
        </li>
        {{#if (eq usuario.rol 'administrador')}}
        <li class="nav-item me-lg-3 mb-2 mb-lg-0">
          <div class="dropdown dropdown-notifications">
            <button class="btn btn-link text-white position-relative p-2 w-100 text-start text-lg-center" type="button"
              id="notificationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-bell fs-5 d-none d-lg-inline"></i>
              <span class="d-lg-none"><i class="bi bi-bell me-2"></i>Notificaciones</span>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none d-lg-block"
                id="notificationBadge" style="display: none;">0</span>
              <span class="badge bg-danger ms-2 d-lg-none" id="notificationBadgeMobile" style="display: none;">0</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end notification-dropdown shadow-lg border-0"
              aria-labelledby="notificationDropdown">
              <li class="dropdown-header fw-bold bg-primary text-white d-flex align-items-center justify-content-between">
                <span><i class="bi bi-bell-fill me-2"></i>Notificaciones</span>
              </li>
              <li><hr class="dropdown-divider m-0"></li>
              <div id="notificationList">
                <li class="px-3 py-3 text-center text-muted">
                  <small><i class="bi bi-hourglass-split me-1"></i>Cargando...</small>
                </li>
              </div>
              <li><hr class="dropdown-divider m-0"></li>
              <li class="px-3 py-2">
                <button class="btn btn-sm btn-outline-primary w-100" id="markAllRead" style="display: none;">
                  <i class="bi bi-check-all me-1"></i>Marcar leídas
                </button>
              </li>
            </ul>
          </div>
        </li>
        {{/if}}
        
        <li class="nav-item dropdown dropdown-user">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-2 fs-5"></i>
            <span>{{usuario.nombre}}</span>
            <span class="badge bg-warning text-dark ms-2 fw-normal d-none d-lg-inline">{{usuario.rol}}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow border-0" aria-labelledby="userDropdown">
            <li class="dropdown-item-text d-lg-none px-3 py-2">
              <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Rol</small><br>
              <strong>{{usuario.rol}}</strong>
            </li>
            <li class="d-lg-none"><hr class="dropdown-divider m-0"></li>
            <li>
              <a class="dropdown-item d-flex align-items-center" href="/perfiles">
                <i class="bi bi-person me-2"></i>Mi perfil
              </a>
            </li>
            <li><hr class="dropdown-divider m-0"></li>
            <li>
              <a class="dropdown-item d-flex align-items-center text-danger fw-semibold" href="#" id="logoutLink">
                <i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
{{/if}}