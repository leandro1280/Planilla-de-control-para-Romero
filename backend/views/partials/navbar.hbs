{{#if usuario}}
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 shadow-sm">
  <div class="container-fluid">
    <!-- Logo/Brand -->
    <a class="navbar-brand d-flex align-items-center fw-bold" href="/inventario" title="Ir al inicio">
      <img src="/img/logo-romero.png" alt="Romero Panificados" class="me-2" style="height: 40px; max-width: 160px; object-fit: contain;">
    </a>

    <!-- Mobile Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" 
            aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Content -->
    <div class="collapse navbar-collapse" id="navbarMain">
      <!-- Main Navigation Links -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'dashboard')}}active{{/if}}" href="/dashboard">
            <i class="bi bi-speedometer2 me-1"></i>Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'inventario')}}active{{/if}}" href="/inventario">
            <i class="bi bi-box-seam me-1"></i>Inventario
          </a>
        </li>
        {{#unless (eq usuario.rol 'operario')}}
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'movimientos')}}active{{/if}}" href="/movimientos">
            <i class="bi bi-list-check me-1"></i>Movimientos
          </a>
        </li>
        {{/unless}}
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'mantenimientos')}}active{{/if}}" href="/mantenimientos">
            <i class="bi bi-tools me-1"></i>Mantenimientos
          </a>
        </li>
        {{#if (eq usuario.rol 'administrador')}}
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'maquinas')}}active{{/if}}" href="/maquinas">
            <i class="bi bi-gear me-1"></i>Máquinas
          </a>
        </li>
        {{/if}}
        {{#if (eq usuario.rol 'administrador')}}
        <li class="nav-item">
          <a class="nav-link {{#if (eq currentPage 'estadisticas')}}active{{/if}}" href="/estadisticas">
            <i class="bi bi-graph-up me-1"></i>Estadísticas
          </a>
        </li>
        {{/if}}
        
      </ul>

      <!-- Right Side Actions -->
      <ul class="navbar-nav align-items-center">
        <!-- QR Scanner Button -->
        <li class="nav-item me-2">
          <button class="btn btn-outline-light btn-sm" type="button" id="btn-qr-universal" title="Escanear código QR">
            <i class="bi bi-qr-code-scan me-1"></i>
            <span class="d-none d-md-inline">QR</span>
          </button>
        </li>

        <!-- Notifications (Admin only) -->
        {{#if (eq usuario.rol 'administrador')}}
        <li class="nav-item dropdown me-2">
          <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button" 
             data-bs-toggle="dropdown" aria-expanded="false" title="Notificaciones">
            <i class="bi bi-bell fs-5"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" 
                  id="notificationBadge" style="display: none; font-size: 0.65rem;">0</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end notification-dropdown" style="min-width: 320px; max-width: 400px;" 
              aria-labelledby="notificationDropdown">
            <li class="dropdown-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                <span><i class="bi bi-bell-fill me-2"></i>Notificaciones</span>
              </div>
            </li>
            <li><hr class="dropdown-divider m-0"></li>
            <div id="notificationList" style="max-height: 350px; overflow-y: auto;">
              <li class="px-3 py-3 text-center text-muted">
                <small><i class="bi bi-hourglass-split me-1"></i>Cargando...</small>
              </li>
            </div>
            <li><hr class="dropdown-divider m-0"></li>
            <li class="px-3 py-2">
              <button class="btn btn-sm btn-outline-primary w-100" id="markAllRead" style="display: none;">
                <i class="bi bi-check-all me-1"></i>Marcar todas como leídas
              </button>
            </li>
          </ul>
        </li>
        {{/if}}

        <!-- User Dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" 
             data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-2 fs-5"></i>
            <span class="d-none d-sm-inline">{{usuario.nombre}}</span>
            <span class="badge bg-light text-dark ms-2 d-none d-lg-inline text-capitalize" style="font-size: 0.7rem;">{{usuario.rol}}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown" style="background-color: #ffffff !important;">
            <li class="dropdown-item-text px-3 py-2" style="color: #2c3e50 !important;">
              <div class="d-flex align-items-center">
                <i class="bi bi-person-circle me-2 fs-4" style="color: #6c757d !important;"></i>
                <div>
                  <div class="fw-semibold" style="color: #1a1a1a !important;">{{usuario.nombre}}</div>
                  <small class="text-capitalize" style="color: #6c757d !important;">{{usuario.rol}}</small>
                </div>
              </div>
            </li>
            <li><hr class="dropdown-divider m-0"></li>
            <li><a class="dropdown-item" href="/perfiles" style="color: #2c3e50 !important;"><i class="bi bi-person me-2"></i>Mi perfil</a></li>
            <li><a class="dropdown-item" href="/auth/cambiar-password" style="color: #2c3e50 !important;"><i class="bi bi-key me-2"></i>Cambiar contraseña</a></li>
            {{#if (eq usuario.rol 'administrador')}}
            <li><hr class="dropdown-divider m-0"></li>
            <li><a class="dropdown-item" href="/auth/usuarios" style="color: #2c3e50 !important;"><i class="bi bi-people me-2"></i>Gestionar Usuarios</a></li>
            <li><a class="dropdown-item" href="/auditoria" style="color: #2c3e50 !important;"><i class="bi bi-file-text me-2"></i>Auditoría</a></li>
            {{/if}}
            <li><hr class="dropdown-divider m-0"></li>
            <li>
              <a class="dropdown-item fw-semibold" href="#" id="logoutLink" style="color: #dc3545 !important;">
                <i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
{{/if}}